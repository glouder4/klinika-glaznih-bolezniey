 === INCOMING AJAX REQUEST ===
Action: getEvent
POST data: {"action":"getEvent","eventId":"110","sessid":"5594a7f52b6d8c8474be9c08fbfe6d96"}
Calendar object created successfully
=== AJAX GET_EVENT ===
AJAX: Requesting event ID: 110
AJAX: getEvent result: {"ID":"110","DATE_FROM":"07.10.2025 10:00:00","DATE_TO":"07.10.2025 12:00:00","DATE_FROM_RAW":"07.10.2025 10:00:00","DATE_TO_RAW":"07.10.2025 12:00:00","TITLE":"\u0432\u0440\u0430\u04471","DESCRIPTION":"","USER_ID":"1","BRANCH_ID":"1","EVENT_COLOR":"#3498db","CONTACT_ENTITY_ID":"8","DEAL_ENTITY_ID":"11","ACTIVITY_ID":"1","NOTE":"2\u0417\u0430\u043c\u0435\u0442\u043a\u04302","EMPLOYEE_ID":"3","CONFIRMATION_STATUS":"confirmed","STATUS":"active","TIME_IS_CHANGED":"1","VISIT_STATUS":"client_came","CREATED_AT":{},"UPDATED_AT":{}}
AJAX: DATE_FROM type: string
AJAX: DATE_TO type: string
AJAX: DATE_FROM value: 07.10.2025 10:00:00
AJAX: DATE_TO value: 07.10.2025 12:00:00
AJAX: Event found, returning success
AJAX: Final event data before JSON: Array
(
    [ID] => 110
    [DATE_FROM] => 07.10.2025 10:00:00
    [DATE_TO] => 07.10.2025 12:00:00
    [DATE_FROM_RAW] => 07.10.2025 10:00:00
    [DATE_TO_RAW] => 07.10.2025 12:00:00
    [TITLE] => врач1
    [DESCRIPTION] => 
    [USER_ID] => 1
    [BRANCH_ID] => 1
    [EVENT_COLOR] => #3498db
    [CONTACT_ENTITY_ID] => 8
    [DEAL_ENTITY_ID] => 11
    [ACTIVITY_ID] => 1
    [NOTE] => 2Заметка2
    [EMPLOYEE_ID] => 3
    [CONFIRMATION_STATUS] => confirmed
    [STATUS] => active
    [TIME_IS_CHANGED] => 1
    [VISIT_STATUS] => client_came
    [CREATED_AT] => Bitrix\Main\Type\DateTime Object
        (
            [value:protected] => DateTime Object
                (
                    [date] => 2025-10-08 16:42:47.000000
                    [timezone_type] => 3
                    [timezone] => Europe/Moscow
                )

            [userTimeEnabled:protected] => 1
        )

    [UPDATED_AT] => Bitrix\Main\Type\DateTime Object
        (
            [value:protected] => DateTime Object
                (
                    [date] => 2025-10-13 12:50:39.000000
                    [timezone_type] => 3
                    [timezone] => Europe/Moscow
                )

            [userTimeEnabled:protected] => 1
        )

)

AJAX: Final DATE_FROM type: string
AJAX: Final DATE_TO type: string
AJAX: JSON result: {"success":true,"event":{"ID":"110","DATE_FROM":"07.10.2025 10:00:00","DATE_TO":"07.10.2025 12:00:00","DATE_FROM_RAW":"07.10.2025 10:00:00","DATE_TO_RAW":"07.10.2025 12:00:00","TITLE":"\u0432\u0440\u0430\u04471","DESCRIPTION":"","USER_ID":"1","BRANCH_ID":"1","EVENT_COLOR":"#3498db","CONTACT_ENTITY_ID":"8","DEAL_ENTITY_ID":"11","ACTIVITY_ID":"1","NOTE":"2\u0417\u0430\u043c\u0435\u0442\u043a\u04302","EMPLOYEE_ID":"3","CONFIRMATION_STATUS":"confirmed","STATUS":"active","TIME_IS_CHANGED":"1","VISIT_STATUS":"client_came","CREATED_AT":{},"UPDATED_AT":{}}}
AJAX: JSON length: 555
AJAX: JSON first 500 chars: {"success":true,"event":{"ID":"110","DATE_FROM":"07.10.2025 10:00:00","DATE_TO":"07.10.2025 12:00:00","DATE_FROM_RAW":"07.10.2025 10:00:00","DATE_TO_RAW":"07.10.2025 12:00:00","TITLE":"\u0432\u0440\u0430\u04471","DESCRIPTION":"","USER_ID":"1","BRANCH_ID":"1","EVENT_COLOR":"#3498db","CONTACT_ENTITY_ID":"8","DEAL_ENTITY_ID":"11","ACTIVITY_ID":"1","NOTE":"2\u0417\u0430\u043c\u0435\u0442\u043a\u04302","EMPLOYEE_ID":"3","CONFIRMATION_STATUS":"confirmed","STATUS":"active","TIME_IS_CHANGED":"1","VISIT_
AJAX: JSON last 500 chars: 2025 10:00:00","DATE_TO":"07.10.2025 12:00:00","DATE_FROM_RAW":"07.10.2025 10:00:00","DATE_TO_RAW":"07.10.2025 12:00:00","TITLE":"\u0432\u0440\u0430\u04471","DESCRIPTION":"","USER_ID":"1","BRANCH_ID":"1","EVENT_COLOR":"#3498db","CONTACT_ENTITY_ID":"8","DEAL_ENTITY_ID":"11","ACTIVITY_ID":"1","NOTE":"2\u0417\u0430\u043c\u0435\u0442\u043a\u04302","EMPLOYEE_ID":"3","CONFIRMATION_STATUS":"confirmed","STATUS":"active","TIME_IS_CHANGED":"1","VISIT_STATUS":"client_came","CREATED_AT":{},"UPDATED_AT":{}}}
AJAX: JSON contains DATE_FROM: YES
AJAX: JSON contains DATE_TO: YES
AJAX: JSON contains empty objects: YES
AJAX: JSON contains quotes around DATE_FROM: YES
AJAX: JSON contains quotes around DATE_TO: YES
AJAX: JSON contains quotes around DATE_FROM value: YES
AJAX: JSON contains quotes around DATE_TO value: YES
AJAX: JSON contains quotes around DATE_FROM value: YES
AJAX: JSON contains quotes around DATE_TO value: YES
AJAX: JSON contains quotes around DATE_FROM value: YES
AJAX: JSON contains quotes around DATE_TO value: YES
AJAX: JSON contains quotes around DATE_FROM value: YES
=== INCOMING AJAX REQUEST ===
Action: getEventContacts
POST data: {"action":"getEventContacts","eventId":"110","sessid":"5594a7f52b6d8c8474be9c08fbfe6d96"}
Calendar object created successfully

=== getEventContactsAction ===
eventId: 110
event found: yes
event USER_ID: 1
event EMPLOYEE_ID: 3
current USER ID: 1
IsAdmin: yes
getContactFromCRM called with contactId: 8
=== INCOMING AJAX REQUEST ===
Action: get_visit_status
POST data: {"action":"get_visit_status","event_id":"110","sessid":"5594a7f52b6d8c8474be9c08fbfe6d96"}
Calendar object created successfully
=== INCOMING AJAX REQUEST ===
Action: get_confirmation_status
POST data: {"action":"get_confirmation_status","event_id":"110","sessid":"5594a7f52b6d8c8474be9c08fbfe6d96"}
=== INCOMING AJAX REQUEST ===
Action: getEmployees
POST data: {"action":"getEmployees","sessid":"5594a7f52b6d8c8474be9c08fbfe6d96"}
Calendar object created successfully
Calendar object created successfully
=== INCOMING AJAX REQUEST ===
Action: getEventDeals
POST data: {"action":"getEventDeals","eventId":"110","sessid":"5594a7f52b6d8c8474be9c08fbfe6d96"}
Calendar object created successfully

=== getEventDealsAction ===
eventId: 110
event found: yes
event USER_ID: 1
event EMPLOYEE_ID: 3
current USER ID: 1
getDealFromCRM called with dealId: 11
CCrmContact::GetListEx result: found
CONTACT_ENTITY_ID: 8
contact found: yes
CCrmDeal::GetListEx result: found
DEAL_ENTITY_ID: 11
deal found: yes
=== INCOMING AJAX REQUEST ===
Action: saveEventDeal
POST data: {"action":"saveEventDeal","eventId":"110","dealData":"{\"id\":\"11\",\"title\":\"\u0418\u0432\u0430\u043d\u043e\u0432 \u0418\u0432\u0430\u043d - 1-111-111-11-11\"}"}
Calendar object created successfully
=== AJAX SAVE_EVENT_DEAL ===
EventId: 110, DealData: "{\"id\":\"11\",\"title\":\"\u0418\u0432\u0430\u043d\u043e\u0432 \u0418\u0432\u0430\u043d - 1-111-111-11-11\"}"
SQL Query updateEventDeal: UPDATE artmax_calendar_events SET DEAL_ENTITY_ID = 11 WHERE ID = 110
Successfully updated deal for event 110 with deal ID 11
SAVE_DEAL: Проверка активности. ACTIVITY_ID=1
SAVE_DEAL: Обновляем существующую активность ID=1
SAVE_DEAL: Обновлена активность ID=1
SAVE_DEAL: Вычисление бронирования:
  DATE_FROM: 07.10.2025 10:00:00
  DATE_TO: 07.10.2025 12:00:00
  branchTimezone: Asia/Yekaterinburg
  serverTime offset: 10800 секунд
  branchTime offset: 18000 секунд
  timeDifference: -7200 секунд
  originalDateTime: 07.10.2025 10:00:00
  correctedDateTime: 07.10.2025 08:00:00
  startDateTime timestamp: 1759813200
  endDateTime timestamp: 1759820400
  durationSeconds: 7200
  EMPLOYEE_ID: 3
  responsibleId: 3
  serviceName: врач1
  ФИНАЛЬНАЯ СТРОКА: user|3|07.10.2025 08:00:00|7200|врач1
SAVE_DEAL: Обновляем бронирование в сделке - Field: UF_CRM_CALENDAR_BOOKING, Value: user|3|07.10.2025 08:00:00|7200|врач1
SAVE_DEAL: Бронирование успешно обновлено в сделке ID=11
Save result: {"success":true,"message":"\u0421\u0434\u0435\u043b\u043a\u0430 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0430 \u0438 \u0431\u0440\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043e"}
=== END AJAX SAVE_EVENT_DEAL ===
