# üîß API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è "–ö–ª–∏–Ω–∏–∫–∞ –≥–ª–∞–∑–Ω—ã—Ö –±–æ–ª–µ–∑–Ω–µ–π"

## –û–±–∑–æ—Ä API

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç RESTful API —á–µ—Ä–µ–∑ AJAX –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è. –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ POST —Å JSON –æ—Ç–≤–µ—Ç–∞–º–∏.

## üåê –ë–∞–∑–æ–≤—ã–π URL

```
/local/components/artmax/calendar/ajax.php
```

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Bitrix24. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `$GLOBALS['USER']->IsAuthorized()`.

## üìù –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–æ–≤

### –ó–∞–≥–æ–ª–æ–≤–∫–∏
```
Content-Type: application/x-www-form-urlencoded
X-Requested-With: XMLHttpRequest
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ POST –¥–∞–Ω–Ω—ã–µ.

## üìã –ú–µ—Ç–æ–¥—ã API

### 1. –°–æ–±—ã—Ç–∏—è (Events)

#### `addEvent` - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `action`: `addEvent`
- `title`: –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
- `description`: –û–ø–∏—Å–∞–Ω–∏–µ
- `dateFrom`: –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ (Y-m-d H:i:s)
- `dateTo`: –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è (Y-m-d H:i:s)
- `branchId`: ID —Ñ–∏–ª–∏–∞–ª–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
- `eventColor`: –¶–≤–µ—Ç —Å–æ–±—ã—Ç–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é #3498db)

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "eventId": 123
}
```

#### `updateEvent` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `action`: `updateEvent`
- `eventId`: ID —Å–æ–±—ã—Ç–∏—è
- `title`: –ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
- `description`: –ù–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
- `dateFrom`: –ù–æ–≤–∞—è –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞
- `dateTo`: –ù–æ–≤–∞—è –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è
- `eventColor`: –ù–æ–≤—ã–π —Ü–≤–µ—Ç
- `branchId`: ID —Ñ–∏–ª–∏–∞–ª–∞

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true
}
```

#### `deleteEvent` - –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `action`: `deleteEvent`
- `eventId`: ID —Å–æ–±—ã—Ç–∏—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true
}
```

#### `getEvent` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `action`: `getEvent`
- `eventId`: ID —Å–æ–±—ã—Ç–∏—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "event": {
    "ID": 123,
    "TITLE": "–ó–∞–ø–∏—Å—å –∫ –≤—Ä–∞—á—É",
    "DESCRIPTION": "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è",
    "DATE_FROM": "2024-01-15 10:00:00",
    "DATE_TO": "2024-01-15 11:00:00",
    "EVENT_COLOR": "#3498db",
    "BRANCH_ID": 1,
    "USER_ID": 456,
    "EMPLOYEE_ID": 789,
    "CONTACT_ENTITY_ID": 101,
    "DEAL_ENTITY_ID": 102,
    "CONFIRMATION_STATUS": "pending",
    "STATUS": "active",
    "VISIT_STATUS": "not_specified"
  }
}
```

#### `getEvents` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–ø–∏—Å–µ–π
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `action`: `getEvents`
- `branchId`: ID —Ñ–∏–ª–∏–∞–ª–∞
- `dateFrom`: –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–∏–æ–¥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `dateTo`: –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "events": [
    {
      "ID": 123,
      "TITLE": "–ó–∞–ø–∏—Å—å –∫ –≤—Ä–∞—á—É",
      "DATE_FROM": "2024-01-15 10:00:00",
      "DATE_TO": "2024-01-15 11:00:00",
      "EVENT_COLOR": "#3498db"
    }
  ]
}
```

### 2. –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ (Schedule)

#### `addSchedule` - –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `action`: `addSchedule`
- `title`: –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- `date`: –î–∞—Ç–∞ (Y-m-d)
- `time`: –í—Ä–µ–º—è (H:i)
- `employee_id`: ID –≤—Ä–∞—á–∞
- `repeat`: –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ (on/off)
- `frequency`: –ß–∞—Å—Ç–æ—Ç–∞ (daily/weekly/monthly)
- `weekdays`: –î–Ω–∏ –Ω–µ–¥–µ–ª–∏ (–º–∞—Å—Å–∏–≤ —á–∏—Å–µ–ª 1-7)
- `repeatEnd`: –û–∫–æ–Ω—á–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è (never/count/date)
- `repeatCount`: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
- `repeatEndDate`: –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è
- `eventColor`: –¶–≤–µ—Ç

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "eventsCreated": 5,
  "events": [...]
}
```

### 3. –ö–ª–∏–µ–Ω—Ç—ã (Clients)

#### `searchClients` - –ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `action`: `searchClients`
- `query`: –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
- `type`: –¢–∏–ø –ø–æ–∏—Å–∫–∞ (contact/deal)

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "clients": [
    {
      "id": 123,
      "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
      "phone": "+7 (999) 123-45-67",
      "email": "ivan@example.com",
      "company": "–û–û–û –ö–æ–º–ø–∞–Ω–∏—è"
    }
  ]
}
```

#### `createContact` - –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `action`: `createContact`
- `contactData`: JSON —Å –¥–∞–Ω–Ω—ã–º–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞
  - `name`: –ò–º—è
  - `lastname`: –§–∞–º–∏–ª–∏—è
  - `phone`: –¢–µ–ª–µ—Ñ–æ–Ω
  - `email`: Email

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "contactId": 123,
  "contact": {...},
  "message": "–ö–æ–Ω—Ç–∞–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω"
}
```

### 4. –§–∏–ª–∏–∞–ª—ã (Branches)

#### `getBranches` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∏–ª–∏–∞–ª–æ–≤
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `action`: `getBranches`

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "branches": [
    {
      "ID": 1,
      "NAME": "–ì–ª–∞–≤–Ω—ã–π —Ñ–∏–ª–∏–∞–ª",
      "ADDRESS": "–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1",
      "PHONE": "+7 (495) 123-45-67",
      "EMAIL": "main@example.com",
      "TIMEZONE_NAME": "Europe/Moscow"
    }
  ]
}
```

#### `addBranch` - –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–ª–∏–∞–ª–∞
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `action`: `addBranch`
- `name`: –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª–∏–∞–ª–∞
- `address`: –ê–¥—Ä–µ—Å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `phone`: –¢–µ–ª–µ—Ñ–æ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `email`: Email (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "branchId": 2,
  "message": "–§–∏–ª–∏–∞–ª —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω"
}
```

#### `getBranchEmployees` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Ñ–∏–ª–∏–∞–ª–∞
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `action`: `getBranchEmployees`
- `branchId`: ID —Ñ–∏–ª–∏–∞–ª–∞

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "employees": [
    {
      "ID": 123,
      "NAME": "–ò–≤–∞–Ω",
      "LAST_NAME": "–ü–µ—Ç—Ä–æ–≤",
      "LOGIN": "ivan.petrov",
      "EMAIL": "ivan@clinic.com"
    }
  ]
}
```

### 5. –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ (Employees)

#### `getEmployees` - –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `action`: `getEmployees`

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "employees": [...]
}
```

#### `searchEmployees` - –ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `action`: `searchEmployees`
- `query`: –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "employees": [...]
}
```

### 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (Settings)

#### `saveBranchSettings` - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–∏–ª–∏–∞–ª–∞
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `action`: `saveBranchSettings`
- `branchId`: ID —Ñ–∏–ª–∏–∞–ª–∞
- `timezoneName`: –ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
- `employeeIds`: JSON –º–∞—Å—Å–∏–≤ ID —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- `branchName`: –ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª–∏–∞–ª–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª–∏–∞–ª–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã"
}
```

## ‚ùå –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏
```json
{
  "success": false,
  "error": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏"
}
```

### –¢–∏–ø—ã –æ—à–∏–±–æ–∫
- `–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `–ú–æ–¥—É–ª—å artmax.calendar –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω` - –º–æ–¥—É–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `–°–æ–±—ã—Ç–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ` - —Å–æ–±—ã—Ç–∏–µ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º ID –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- `–ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ` - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- `–í—Ä–µ–º—è —É–∂–µ –∑–∞–Ω—è—Ç–æ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤—Ä–∞—á–∞` - –∫–æ–Ω—Ñ–ª–∏–∫—Ç –≤—Ä–µ–º–µ–Ω–∏

## üîç –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### JavaScript –ø—Ä–∏–º–µ—Ä
```javascript
// –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
fetch('/local/components/artmax/calendar/ajax.php', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded',
    'X-Requested-With': 'XMLHttpRequest'
  },
  body: new URLSearchParams({
    action: 'addEvent',
    title: '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è',
    description: '–ü–µ—Ä–≤–∏—á–Ω—ã–π –ø—Ä–∏–µ–º',
    dateFrom: '2024-01-15 10:00:00',
    dateTo: '2024-01-15 11:00:00',
    branchId: 1,
    eventColor: '#3498db'
  })
})
.then(response => response.json())
.then(data => {
  if (data.success) {
    console.log('–ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–Ω–∞:', data.eventId);
  } else {
    console.error('–û—à–∏–±–∫–∞:', data.error);
  }
});
```

### PHP –ø—Ä–∏–º–µ—Ä
```php
// –ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
$postData = [
    'action' => 'searchClients',
    'query' => '–ò–≤–∞–Ω',
    'type' => 'contact'
];

$response = file_get_contents('/local/components/artmax/calendar/ajax.php', false, 
    stream_context_create([
        'http' => [
            'method' => 'POST',
            'header' => 'Content-Type: application/x-www-form-urlencoded',
            'content' => http_build_query($postData)
        ]
    ])
);

$data = json_decode($response, true);
if ($data['success']) {
    foreach ($data['clients'] as $client) {
        echo $client['name'] . ' - ' . $client['phone'] . "\n";
    }
}
```

## üìä –õ–∏–º–∏—Ç—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ú–∞–∫—Å–∏–º—É–º 10 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ú–∞–∫—Å–∏–º—É–º 100 –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–æ–±—ã—Ç–∏–π
- –¢–∞–π–º–∞—É—Ç AJAX –∑–∞–ø—Ä–æ—Å–æ–≤: 30 —Å–µ–∫—É–Ω–¥
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä POST –¥–∞–Ω–Ω—ã—Ö: 8MB

## üîÑ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è API: **1.0**

–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ API –±—É–¥—É—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –≤–µ—Ä—Å–∏–∏ –∏ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

---

*–î–æ–∫—É–º–µ–Ω—Ç –∞–∫—Ç—É–∞–ª–µ–Ω –Ω–∞: 04.10.2025*  
*–í–µ—Ä—Å–∏—è API: 1.0*
